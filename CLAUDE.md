# Japan æ—…éŠåœ°åœ–å°ˆæ¡ˆèªªæ˜

é€™å€‹è³‡æ–™å¤¾åŒ…å«ä¸€å€‹ç¶²é ç‰ˆçš„æ—¥æœ¬æ—…éŠåœ°åœ–ï¼Œæœƒè®€å– `notes.md` ä¸¦å°‡æ™¯é»é¡¯ç¤ºåœ¨äº’å‹•åœ°åœ–ä¸Šã€‚

## æª”æ¡ˆçµæ§‹

- `index.html` - æ—…éŠåœ°åœ–ç¶²é ä»‹é¢ï¼ˆç´” HTML çµæ§‹ï¼Œç„¡å…§åµŒ CSS/JSï¼‰
- `styles.css` - æ‰€æœ‰ CSS æ¨£å¼
- `js/` - JavaScript ES æ¨¡çµ„ç›®éŒ„
  - `js/state.js` - å…±äº«ç‹€æ…‹ç‰©ä»¶ï¼ˆç„¡ä»»ä½• importï¼Œç‚ºæ‰€æœ‰æ¨¡çµ„çš„æ ¹ç¯€é»ï¼‰
  - `js/utils.js` - ç´”å·¥å…·å‡½å¼ï¼ˆgetDayStringã€getCatNameã€processMarkdownForDisplayã€updateTripInfoBarï¼‰
  - `js/weather.js` - å¤©æ°£é å ±ï¼ˆopen-meteo APIï¼‰
  - `js/map.js` - åœ°åœ–åˆå§‹åŒ–èˆ‡æ“ä½œï¼ˆinitMapã€highlightMarkerã€getLocationã€checkMapLabelsï¼‰
  - `js/ui.js` - UI æ¸²æŸ“èˆ‡äº’å‹•ï¼ˆupdateViewã€è©³ç´°é ã€å¡ç‰‡ã€ç¯©é¸å™¨ã€Bottom Sheetã€Sortable è¨­å®šï¼‰
  - `js/data.js` - è³‡æ–™è¼‰å…¥èˆ‡å„²å­˜ï¼ˆparseMarkdownã€loadDataã€updateDayã€saveContentã€refreshDataï¼‰
  - `js/theme.js` - ä¸»é¡Œåˆ‡æ›ã€FABã€æœå°‹æ¡†ã€åŒ¯å‡ºè¡Œç¨‹
  - `js/settings.js` - æ—…éŠè¨­å®š Modalï¼ˆopenSettingsã€saveSettingsï¼‰
  - `js/main.js` - å…¥å£é»ï¼ˆåˆå§‹åŒ–å„æ¨¡çµ„ã€æ›è¼‰ `window.*` å…¨åŸŸå‡½å¼ï¼‰
- `notes.md` - æ™¯é»è³‡æ–™ï¼ˆä¸»è¦ç·¨è¼¯çš„æª”æ¡ˆï¼‰
- `start.sh` - ä¸€éµå•Ÿå‹•è…³æœ¬ï¼ˆåŒæ™‚å•Ÿå‹• HTTP server å’Œ localtunnelï¼‰
- `assets/` - éœæ…‹è³‡æº

## å•Ÿå‹•æœå‹™

```bash
./start.sh
```

è…³æœ¬æœƒè‡ªå‹•ï¼š
1. æ¸…ç† port 8090 çš„èˆŠé€²ç¨‹
2. åœ¨èƒŒæ™¯å•Ÿå‹• Python HTTP serverï¼ˆport 8090ï¼‰
3. åœ¨èƒŒæ™¯å•Ÿå‹• localtunnelï¼ˆå›ºå®šå­åŸŸå `japan-zi-jian`ï¼‰ï¼Œlog å¯«è‡³ `/tmp/japan_lt.log`
4. localtunnel å´©æ½°æ™‚è‡ªå‹•é‡å•Ÿï¼Œç¶²å€ä¸è®Š
5. å°å‡ºå…¬é–‹ç¶²å€ä¸¦å¯«å…¥ `current_url.txt`

**å…¬é–‹ç¶²å€å›ºå®šç‚ºï¼š** `https://japan-zi-jian.loca.lt`ï¼ˆä¸å†éš¨é‡å•Ÿæ”¹è®Šï¼‰

> **æ³¨æ„**ï¼šjapan ä½¿ç”¨ localtunnelï¼Œtodo ä½¿ç”¨ ngrokï¼Œå…©è€…äº’ä¸è¡çªï¼Œå¯åŒæ™‚é‹ä½œã€‚

æŒ‰ `Ctrl+C` åœæ­¢æ‰€æœ‰æœå‹™ã€‚

## localtunnel ä½¿ç”¨èªªæ˜

### Friendly Reminder é é¢ï¼ˆé¦–æ¬¡è¨ªå•ï¼‰

ç¬¬ä¸€æ¬¡é–‹å•Ÿ localtunnel ç¶²å€æ™‚ï¼Œæœƒå‡ºç¾ä¸€å€‹é©—è­‰é é¢ï¼Œéœ€è¦è¼¸å…¥ã€Œå®¶è£¡é‚£å°é›»è…¦ï¼ˆè·‘ localtunnel çš„ä¸»æ©Ÿï¼‰ã€çš„å…¬é–‹ IP æ‰èƒ½é€²å…¥ã€‚

**æŸ¥è©¢ IP çš„æ–¹æ³•ï¼š**

åœ¨å®¶è£¡é‚£å°è·‘ localtunnel çš„é›»è…¦ä¸ŠæŸ¥è©¢ï¼ˆæˆ–è«‹ assistant å›å ±ï¼‰ã€‚ç”¨ç€è¦½å™¨é–‹å•Ÿä»¥ä¸‹ç¶²å€ï¼Œé¡¯ç¤ºçš„æ•¸å­—å°±æ˜¯è¦è¼¸å…¥çš„ IPï¼š

```
https://api.ipify.org
```

è¼¸å…¥ IP é€å‡ºå¾Œå³å¯é€²å…¥ï¼Œ**åŒä¸€å€‹ session å…§ä¸éœ€å†è¼¸å…¥**ï¼ˆé—œæ‰åˆ†é æˆ–é‡æ–°æ•´ç†ä¸å—å½±éŸ¿ï¼Œç›´åˆ°æ¸…é™¤ç€è¦½å™¨è³‡æ–™ç‚ºæ­¢ï¼‰ã€‚

### èˆ‡ ngrok çš„å·®ç•°

| é …ç›® | localtunnelï¼ˆjapanï¼‰ | ngrokï¼ˆtodoï¼‰ |
|------|----------------------|---------------|
| è²»ç”¨ | å…è²»ï¼Œç„¡ session é™åˆ¶ | å…è²»ï¼Œé™ 1 å€‹ session |
| é¦–æ¬¡è¨ªå• | éœ€è¼¸å…¥ IP é€šéé©—è­‰ | ç„¡é¡å¤–é©—è­‰ |
| URL æ ¼å¼ | `https://xxx.loca.lt` | `https://xxx.ngrok-free.app` |
| URL å›ºå®šæ€§ | **å›ºå®š**ï¼ˆ`--subdomain japan-zi-jian`ï¼‰ | æ¯æ¬¡é‡å•Ÿéƒ½æœƒæ”¹è®Š |

## æŸ¥è©¢ç›®å‰ç¶²å€

ç•¶ç”¨æˆ¶è©¢å•ã€Œæ—¥æœ¬åœ°åœ–ç¶²å€ã€æˆ–é¡ä¼¼å•é¡Œæ™‚ï¼Œç›´æ¥è®€å– `current_url.txt`ï¼š

```bash
head -n 1 /Users/zi-jianchen/.openclaw/workspace/projects/japan/current_url.txt
```

å¦‚æœæª”æ¡ˆä¸å­˜åœ¨æˆ–æ˜¯ç©ºçš„ï¼Œè¡¨ç¤ºæœå‹™æœªå•Ÿå‹•ï¼Œè«‹å‘ŠçŸ¥ç”¨æˆ¶éœ€è¦å…ˆåŸ·è¡Œ `./start.sh`ã€‚

## Assistant behavior: å›ç­”æ—¥æœ¬æ—…éŠç¶²å€
ç•¶ç”¨æˆ¶è©¢å•ã€Œæ—¥æœ¬æ—…éŠç¶²å€ï¼æ—¥æœ¬åœ°åœ–ç¶²å€ã€æ™‚ï¼š
1) å„ªå…ˆè®€å– `current_url.txt` ç¬¬ä¸€è¡Œ
2) è‹¥ä¸å­˜åœ¨æˆ–æ˜¯ç©ºçš„ï¼šæç¤ºå…ˆåŸ·è¡Œ `./start.sh`


## ä»‹é¢é…ç½®èˆ‡å…ƒä»¶å‘½å

### é›»è…¦ç‰ˆï¼ˆå¯¬åº¦ â‰¥ 769pxï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å´é‚Šæ¬„ #sidebar       â”‚           åœ°åœ– #map               â”‚
â”‚         (å›ºå®š 420px)          â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                  â”‚
â”‚  â”‚ æ¨™é¡Œåˆ— .header-row      â”‚  â”‚      [Leaflet äº’å‹•åœ°åœ–]           â”‚
â”‚  â”‚  âœˆ ä¹å·è‡ªç”±è¡Œ  ğŸŒ™ğŸ·ğŸ“¤âš™  â”‚  â”‚                                  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚                                  â”‚
â”‚  â”‚ æ—…éŠæ—¥æœŸåˆ— #tripInfoBar â”‚  â”‚                                  â”‚
â”‚  â”‚ å¤©æ°£åˆ— #weatherInfoBar  â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ æœå°‹æ¡† .search-wrapper  â”‚  â”‚         â”‚ è·¯ç·šæŒ‰éˆ•       â”‚        â”‚
â”‚  â”‚ ç¯©é¸åˆ— .filters         â”‚  â”‚         â”‚ #dayRouteBtn  â”‚        â”‚
â”‚  â”‚ [å…¨éƒ¨][ç¾é£Ÿ]â€¦ [Dayâ–¼]   â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚                        â”Œâ”€â”€â”€â”     â”‚
â”‚  â”‚ æ™¯é»æ¸…å–® #list-containerâ”‚  â”‚                        â”‚ âœ› â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚                        â”‚å®šä½â”‚    â”‚
â”‚  â”‚  â”‚ æ™¯é»å¡ç‰‡ .card    â”‚  â”‚  â”‚                        â””â”€â”€â”€â”˜     â”‚
â”‚  â”‚  â”‚ â˜° æ¨™é¡Œ   [åˆ†é¡]   â”‚  â”‚  â”‚                   .locate-btn    â”‚
â”‚  â”‚  â”‚ æƒ³åšä»€éº¼ï¼ˆæˆªæ–·ï¼‰   â”‚  â”‚  â”‚                                  â”‚
â”‚  â”‚  â”‚ [å‚™è¨» âˆ¨]          â”‚  â”‚  â”‚                                  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é»æ“Šåœ°åœ–æ¨™è¨˜æ™‚ â†’ å½ˆå‡ºè¦–çª— Popupï¼ˆé›»è…¦ç‰ˆå°ˆç”¨ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Popup Header .popup-header  â”‚
â”‚  [åˆ†é¡å¾½ç« ]   [âœ][âœ•]        â”‚
â”‚  æ™¯é»åç¨±                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Popup Body .popup-body      â”‚
â”‚  æƒ³åšä»€éº¼ï¼ˆå¯æ²å‹•ï¼‰           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚  å‚™è¨»ï¼ˆå¯æ²å‹•ï¼‰               â”‚
â”‚  å…¶ä»–å…§å®¹                    â”‚
â”‚  åœ–ç‰‡ç•«å»Š .image-gallery     â”‚
â”‚  â”Œâ”€â”€â”€â”€ è¡Œç¨‹å¤©æ•¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Day é¸å–® .day-select   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  [ å°èˆªå»é€™è£¡ .nav-btn ]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ‰‹æ©Ÿç‰ˆï¼ˆå¯¬åº¦ â‰¤ 768pxï¼‰

**é è¨­ç‹€æ…‹ï¼ˆBottom Sheet åŠå±•é–‹ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              â”‚
â”‚    Leaflet åœ°åœ–ï¼ˆå…¨è¢å¹•ï¼‰      â”‚
â”‚                              â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚          â”‚è·¯ç·šæŒ‰éˆ•        â”‚   â”‚
â”‚          â”‚#dayRouteBtn  â”‚   â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”  â”‚
â”‚                    â”‚ FAB â”‚  â”‚  â† æµ®å‹•å·¥å…·æŒ‰éˆ• .fab-container
â”‚                    â””â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     æ‹‰æ¡¿ .mobile-toggle-bar  â”‚  â† æ‹–æ›³æ­¤è™•èª¿æ•´ sheet é«˜åº¦
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¯©é¸åˆ— .filters              â”‚  â† Bottom Sheet .#sidebar
â”‚  [å…¨éƒ¨][ç¾é£Ÿ]â€¦ [Dayâ–¼]        â”‚
â”‚  å¤©æ°£åˆ— #weatherInfoBar       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ™¯é»æ¸…å–® #list-container     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ æ™¯é»å¡ç‰‡ .card         â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Bottom Sheet ä¸‰æ®µå¼é«˜åº¦ï¼ˆæ‹–æ›³å¸é™„ï¼‰**

| ç‹€æ…‹ | é«˜åº¦ | èªªæ˜ |
|------|------|------|
| æ”¶èµ· | 140px | åªçœ‹åˆ°ç¯©é¸åˆ—ï¼ŒFAB èˆ‡è·¯ç·šæŒ‰éˆ•å¯è¦‹ |
| ä¸­é–“ï¼ˆé è¨­ï¼‰| 45vh | çœ‹åˆ°éƒ¨åˆ†æ™¯é»æ¸…å–® |
| å…¨å±•é–‹ | è¦–çª—é«˜åº¦ - 100px | å¹¾ä¹è“‹ä½æ•´å€‹åœ°åœ–ï¼ŒFAB éš±è—ï¼ˆç”¨ `dvh` å–®ä½é¿å…æ‰‹æ©Ÿç€è¦½å™¨ UI bar é€ æˆæº¢å‡ºï¼‰|

**é»æ“Šæ™¯é»å¡ç‰‡æˆ–æ¨™è¨˜æ™‚ â†’ è©³ç´°é  #detail-containerï¼ˆå–ä»£æ¸…å–®ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              â”‚
â”‚    Leaflet åœ°åœ–ï¼ˆç¸®å°è‡³ä¸Šæ–¹ï¼‰  â”‚
â”‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è©³ç´°é é ‚åˆ— .detail-header-bar â”‚
â”‚  â† è¿”å›    [âœ] [D1] [ç¾é£Ÿ]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è©³ç´°é å…§å®¹ .detail-scroll-areaâ”‚
â”‚  æ™¯é»åç¨± .detail-title       â”‚
â”‚  â”Œâ”€â”€Day é¸å–®â”€â”€â” [å°èˆª] .nav-pillâ”‚
â”‚  åœ–ç‰‡ç•«å»Šï¼ˆå¦‚æœ‰ï¼‰              â”‚
â”‚  æƒ³åšä»€éº¼                     â”‚
â”‚  å‚™è¨»                        â”‚
â”‚  å…¶ä»–å…§å®¹                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è©³ç´°é ç·¨è¼¯æ¨¡å¼ï¼ˆé»æ“Š âœ å¾Œï¼‰**

```
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å–æ¶ˆ]            [å„²å­˜]     â”‚
â”‚  â”Œâ”€ æƒ³åšä»€éº¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ textarea                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€ å‚™è¨» â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ textarea                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
```

**FAB å±•é–‹å¾Œ**

```
[æœå°‹ğŸ”] [å®šä½âœ›] [æ¨™ç±¤ğŸ·] [ä¸»é¡ŒğŸŒ™] [åŒ¯å‡ºğŸ“¤] [è¨­å®šâš™]  â†â†’  [â˜°]
                                                        fab-actions   fab-toggle
```

**æµ®å‹•æœå°‹æ¡† #floatingSearchï¼ˆé» FAB æœå°‹å¾Œå‡ºç¾æ–¼ç•«é¢é ‚éƒ¨ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” æœå°‹ç­†è¨˜...            âœ•  â”‚  â† .mobile-floating-search
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### å…±ç”¨ Modalï¼ˆå…©ç‰ˆæœ¬çš†æœ‰ï¼‰

| Modal | ID | è§¸ç™¼æ–¹å¼ |
|-------|----|---------|
| æ—…éŠè¨­å®š | `#settingsModal` | é» âš™ è¨­å®šæŒ‰éˆ• |
| é–±è®€ Modal | `#readingModal` | é»æ“Šç„¡åº§æ¨™æ™¯é»ï¼ˆé›»è…¦ç‰ˆï¼‰|

---

### å…ƒä»¶å‘½åé€ŸæŸ¥è¡¨

| ä¸­æ–‡åç¨± | HTML ID / class | æ‰€åœ¨ç‰ˆæœ¬ |
|---------|----------------|---------|
| å´é‚Šæ¬„ | `#sidebar` | å…©ç‰ˆæœ¬ï¼ˆé›»è…¦å›ºå®šï¼Œæ‰‹æ©Ÿç‚º bottom sheetï¼‰|
| æ¨™é¡Œåˆ— | `.header-row` | é›»è…¦ç‰ˆ |
| æ—…éŠæ—¥æœŸåˆ— | `#tripInfoBar` | é›»è…¦ç‰ˆ |
| å¤©æ°£åˆ— | `#weatherInfoBar` | å…©ç‰ˆæœ¬ |
| æœå°‹æ¡†ï¼ˆé›»è…¦ï¼‰| `#searchInput` | é›»è…¦ç‰ˆ |
| ç¯©é¸åˆ— | `.filters` | å…©ç‰ˆæœ¬ |
| é¡åˆ¥ç¯©é¸éˆ• | `.filter-btn` | å…©ç‰ˆæœ¬ |
| å¤©æ•¸ä¸‹æ‹‰é¸å–® | `#dayFilterDropdown` | å…©ç‰ˆæœ¬ |
| æ™¯é»æ¸…å–® | `#list-container` | å…©ç‰ˆæœ¬ |
| æ™¯é»å¡ç‰‡ | `.card` | å…©ç‰ˆæœ¬ |
| å¡ç‰‡æ‹–æ›³æŠŠæ‰‹ | `.drag-handle` | å…©ç‰ˆæœ¬ï¼ˆDay ç¯©é¸æ™‚æ‰å‡ºç¾ï¼‰|
| å¡ç‰‡å‚™è¨»å±•é–‹éˆ• | `.expand-btn` | å…©ç‰ˆæœ¬ |
| åœ°åœ– | `#map` | å…©ç‰ˆæœ¬ |
| åœ°åœ–æ¨™è¨˜ | `.marker-inner` | å…©ç‰ˆæœ¬ |
| åœ°åœ– Popup | `.leaflet-popup-content-wrapper` | é›»è…¦ç‰ˆ |
| è·¯ç·šæŒ‰éˆ• | `#dayRouteBtn` | å…©ç‰ˆæœ¬ |
| å®šä½æŒ‰éˆ• | `.locate-btn` | é›»è…¦ç‰ˆ |
| æ‹‰æ¡¿ | `.mobile-toggle-bar` | æ‰‹æ©Ÿç‰ˆ |
| è©³ç´°é  | `#detail-container` | æ‰‹æ©Ÿç‰ˆ |
| è©³ç´°é é ‚åˆ— | `.detail-header-bar` | æ‰‹æ©Ÿç‰ˆ |
| FAB å®¹å™¨ | `#fabContainer` | æ‰‹æ©Ÿç‰ˆ |
| FAB ä¸»æŒ‰éˆ• | `.fab-toggle` | æ‰‹æ©Ÿç‰ˆ |
| FAB å·¥å…·åˆ— | `.fab-actions` | æ‰‹æ©Ÿç‰ˆ |
| æµ®å‹•æœå°‹æ¡† | `#floatingSearch` | æ‰‹æ©Ÿç‰ˆ |
| è¨­å®š Modal | `#settingsModal` | å…©ç‰ˆæœ¬ |
| é–±è®€ Modal | `#readingModal` | é›»è…¦ç‰ˆ |
| åœ–ç‰‡ç•«å»Š | `.image-gallery` | å…©ç‰ˆæœ¬ |

---

## ç‚ºä»€éº¼éœ€è¦ HTTP serverï¼Ÿ

`index.html` ä½¿ç”¨ `fetch('notes.md')` è®€å–è³‡æ–™ï¼Œé€™åœ¨ `file://` å”å®šä¸‹æœƒè¢«ç€è¦½å™¨çš„å®‰å…¨æ”¿ç­–å°é–ï¼Œå¿…é ˆé€é HTTP server æ‰èƒ½æ­£å¸¸é‹ä½œã€‚

## notes.md æ ¼å¼

æ¯å€‹æ™¯é»ä»¥ `# [åˆ†é¡] åç¨±` ä½œç‚ºæ¨™é¡Œï¼Œæ”¯æ´ä»¥ä¸‹åˆ†é¡ï¼š

| åˆ†é¡æ¨™ç±¤ | é¡¯ç¤ºé¡åˆ¥ |
|----------|----------|
| ç¾é£Ÿã€é¤å»³ | ç¾é£Ÿï¼ˆç´…è‰²ï¼‰ |
| æ™¯é»ã€æ•´ç† | æ™¯é»ï¼ˆè—è‰²ï¼‰ |
| ä½å®¿ã€é£¯åº— | ä½å®¿ï¼ˆç¶ è‰²ï¼‰ |
| è³¼ç‰© | è³¼ç‰©ï¼ˆæ©˜è‰²ï¼‰ |

ç¯„ä¾‹æ ¼å¼ï¼š

```markdown
# [ç¾é£Ÿ] ä¸€è˜­æ‹‰éºµ åšå¤šæœ¬åº—
> åº§æ¨™: 33.5897, 130.4207
> åœ°å€: ç¦å²¡å¸‚åšå¤šå€ä¸­æ´²5-3-2
> é€£çµ: https://maps.app.goo.gl/xxxxx

### æƒ³åšä»€éº¼
- é»æ‹›ç‰Œè±šéª¨æ‹‰éºµï¼Œé¸ç¡¬éºµã€æ¿ƒæ¹¯åº•

### å‚™è¨»
- 24 å°æ™‚ç‡Ÿæ¥­ï¼Œå»ºè­°é¿é–‹ç”¨é¤å°–å³°æ™‚æ®µ
```

## æ–°å¢æˆ–ä¿®æ”¹æ™¯é»

ç›´æ¥ç·¨è¼¯ `notes.md` å³å¯ï¼Œå­˜æª”å¾Œåœ¨ç€è¦½å™¨é‡æ–°æ•´ç†é é¢å°±æœƒçœ‹åˆ°æ›´æ–°ã€‚åº§æ¨™å¯ä»¥å¾ Google Maps è¤‡è£½ï¼ˆå³éµé»åœ°åœ– â†’ è¤‡è£½åº§æ¨™ï¼‰ã€‚

æ²’æœ‰åº§æ¨™çš„æ™¯é»ä»æœƒå‡ºç¾åœ¨å·¦å´åˆ—è¡¨ï¼Œä¸¦æ¨™ç¤ºã€Œç¼ºåº§æ¨™ã€ï¼Œé»æ“Šå¾Œæœƒè‡ªå‹•é–‹å•Ÿ Google Maps æœå°‹ã€‚

## æ•…éšœæ’é™¤ï¼šèƒ½å•Ÿå‹•ä½†é€£ä¸é€²å»

### ç—‡ç‹€
- `start.sh` æˆåŠŸå°å‡ºå…¬é–‹ç¶²å€
- ç€è¦½å™¨é–‹å•Ÿå¾Œä¸€ç›´è½‰åœˆã€timeoutï¼Œæˆ–ç­‰å¾ˆä¹…æ‰æœ‰åæ‡‰

### æ ¹æœ¬åŸå› 
`server.py` åŸæœ¬ä½¿ç”¨å–®åŸ·è¡Œç·’çš„ `TCPServer`ï¼Œlocaltunnel æœƒå»ºç«‹ HTTP keep-alive æŒä¹…é€£ç·šï¼Œå°è‡´ server è¢«ä½”ä½ã€ç„¡æ³•è™•ç†ç€è¦½å™¨çš„æ–°è«‹æ±‚ã€‚

**å·²æ–¼ 2026-02-19 ä¿®å¾©**ï¼š`server.py` æ”¹ç”¨ `ThreadingTCPServer`ï¼Œè‹¥å†æ¬¡å‡ºç¾è«‹é‡å•Ÿ `start.sh`ã€‚

### å¿«é€Ÿè¨ºæ–·

```bash
# ç¢ºèª server æœ‰å›æ‡‰ï¼ˆæ‡‰ç«‹å³å›å‚³ 200ï¼Œè‹¥å¡ä½æˆ– 000 è¡¨ç¤º server æ²’èµ·ä¾†ï¼‰
curl -s -o /dev/null -w "%{http_code}" --max-time 5 http://localhost:8090/
```

### è¬ç”¨é‡å•ŸæŒ‡ä»¤

```bash
lsof -ti:8090 | xargs kill -9 2>/dev/null
pkill -f "localtunnel"
cd /Users/zi-jianchen/.openclaw/workspace/projects/japan && ./start.sh
```

---

## æ•…éšœæ’é™¤ï¼šå…¬é–‹ç¶²å€çªç„¶å¤±æ•ˆï¼ˆlocaltunnel å´©æ½°ï¼‰

### ç—‡ç‹€
- server æœ¬åœ°æ­£å¸¸ï¼ˆcurl localhost:8090 å›å‚³ 200ï¼‰
- ä½†å…¬é–‹ç¶²å€ `https://japan-zi-jian.loca.lt` ç„¡æ³•é€£å…¥

### èªªæ˜
`start.sh` å·²å…§å»ºè‡ªå‹•é‡å•Ÿæ©Ÿåˆ¶ï¼Œlocaltunnel å´©æ½°å¾Œæœƒåœ¨ 3 ç§’å…§è‡ªå‹•æ¢å¾©ï¼Œ**é€šå¸¸ä¸éœ€è¦æ‰‹å‹•è™•ç†**ï¼Œç­‰å¹¾ç§’å†è©¦å³å¯ã€‚

è‹¥é•·æ™‚é–“ç„¡æ³•é€£å…¥ï¼Œæ‰éœ€è¦æ‰‹å‹•ä»‹å…¥ï¼š

### è¨ºæ–·

```bash
cat /tmp/japan_lt.log
```

è‹¥çœ‹åˆ°é¡ä¼¼ä»¥ä¸‹éŒ¯èª¤ï¼Œä»£è¡¨ localtunnel æ­£åœ¨é‡å•Ÿä¸­ï¼š

```
Error: connection refused: localtunnel.me:XXXXX (check your firewall settings)
[HH:MM:SS] localtunnel ä¸­æ–·ï¼Œ3 ç§’å¾Œé‡å•Ÿ...
```

### æ‰‹å‹•é‡å•Ÿï¼ˆæœ€å¾Œæ‰‹æ®µï¼‰

```bash
lsof -ti:8090 | xargs kill -9 2>/dev/null
pkill -f "localtunnel"
cd /Users/zi-jianchen/.openclaw/workspace/projects/japan && ./start.sh
```

ç¶²å€å›ºå®šç‚º `https://japan-zi-jian.loca.lt`ï¼Œé‡å•Ÿå¾Œä¸è®Šã€‚

---

## æ›´æ–°ç´€éŒ„

### 2026-02-19
- **tunnel å·¥å…·å¾ ngrok æ”¹ç‚º localtunnel**
  - åŸå› ï¼šngrok å…è²»å¸³è™ŸåŒæ™‚åªå…è¨± 1 å€‹ active sessionï¼Œjapan å’Œ todo åŒæ™‚è·‘æœƒè¡çª
  - `start.sh` æ”¹ç”¨ `npx localtunnel --port 8090`ï¼Œstdout å°å‘ `/tmp/japan_lt.log`
  - URL å¾ log ä»¥ grep è§£æï¼ˆæ ¼å¼ï¼š`https://xxx.loca.lt`ï¼‰
  - trap cleanup æ”¹ç‚ºåŒæ™‚ kill server å’Œ localtunnel é€²ç¨‹ï¼Œä¸¦æ¸…ç† log æª”
  - localtunnel é¦–æ¬¡è¨ªå•éœ€é€šé Friendly Reminder é é¢ï¼ˆè¼¸å…¥è‡ªå·±çš„ IPï¼Œä¸€æ¬¡å³å¯ï¼‰
- **ä¿®å¾© server å–®åŸ·è¡Œç·’å•é¡Œ**
  - `server.py` å¾ `TCPServer` æ”¹ç‚º `ThreadingTCPServer`
  - åŸå› ï¼šlocaltunnel çš„ keep-alive é€£ç·šæœƒå¡æ­»å–®åŸ·è¡Œç·’ serverï¼Œå°è‡´ç€è¦½å™¨ç„¡æ³•é€£å…¥

### 2026-02-20
- **å›ºå®š localtunnel å­åŸŸå**
  - `start.sh` åŠ å…¥ `--subdomain japan-zi-jian`ï¼Œç¶²å€å›ºå®šç‚º `https://japan-zi-jian.loca.lt`
  - é‡å•Ÿå¾Œä¸å†éœ€è¦æ›´æ–°ç¶²å€ï¼Œåœ¨åœ‹å¤–ä¹Ÿèƒ½ç›´æ¥ä½¿ç”¨å›ºå®šç¶²å€
- **localtunnel è‡ªå‹•é‡å•Ÿ**
  - `start.sh` æ”¹ç”¨ while è¿´åœˆåŒ…ä½ localtunnelï¼Œå´©æ½°å¾Œè‡ªå‹• 3 ç§’é‡å•Ÿï¼Œç„¡éœ€æ‰‹å‹•ä»‹å…¥
- **ä¿®å¾© start.sh è·¯å¾‘å•é¡Œ**
  - åŸæœ¬ `cd "$(dirname "$0")"` åœ¨ç›¸å°è·¯å¾‘å‘¼å«æ™‚ç„¡æ•ˆï¼Œå°è‡´ `python3 server.py` éœé»˜å¤±æ•—
  - æ”¹ç‚ºç¡¬å¯«çµ•å°è·¯å¾‘ `SCRIPT_DIR`ï¼Œç¢ºä¿å¾ä»»ä½•ç›®éŒ„åŸ·è¡Œéƒ½èƒ½æ­£ç¢ºå•Ÿå‹•

### 2026-02-22
- **index.html æ¨¡çµ„åŒ–æ‹†åˆ†**ï¼ˆè©³è¦‹ä¸‹æ–¹ã€Šå‰ç«¯æ¨¡çµ„æ¶æ§‹ã€‹ç« ç¯€ï¼‰
  - åŸæœ¬ 1037 è¡Œçš„å–®ä¸€ `index.html` æ‹†åˆ†ç‚º 1 å€‹ CSS æª” + 9 å€‹ ES æ¨¡çµ„ + ç²¾ç°¡å¾Œçš„ HTML
  - `server.py` ç„¡é ˆä¿®æ”¹ï¼ˆ`SimpleHTTPRequestHandler` ç›´æ¥æä¾›éœæ…‹æª”æ¡ˆï¼‰
- **åœ°åœ–åœ–å±¤æ›æº**ï¼ˆ`js/map.js`ï¼‰
  - Tile layer å¾ CartoDB æ”¹ç‚º Google Mapsï¼ˆ`mt1.google.com/vt/lyrs=m&hl=zh-TW`ï¼‰ï¼Œé¡¯ç¤ºä¸­æ–‡åœ°å
- **æ–°å¢ refreshData åŠŸèƒ½**ï¼ˆ`js/data.js` + `js/main.js`ï¼‰
  - `refreshData(btnElement)`ï¼šè§¸ç™¼ FAB æŒ‰éˆ• spin å‹•ç•« 800ms â†’ å‘¼å« `loadData()` ç„¡ç¸«é‡è®€ notes.md â†’ é—œé–‰ FAB
  - `main.js` åŠ å…¥ `window.refreshData = refreshData` ä¾› HTML å‘¼å«
- **Bottom Sheet è¡Œç‚ºæ”¹å–„**ï¼ˆ`js/ui.js` + `styles.css`ï¼‰
  - æœ€å¤§é«˜åº¦æ”¹ç‚º `è¦–çª—é«˜åº¦ - 100px`ï¼ˆJS ç«¯ï¼š`h - 100`ï¼›CSS ç«¯ï¼š`calc(100dvh - 100px)`ï¼‰ï¼›ä½¿ç”¨ `dvh` é¿å…æ‰‹æ©Ÿç€è¦½å™¨åº•éƒ¨ UI bar æº¢å‡º
  - æ‹–æ›³è¡Œç‚ºï¼šæ‹‰æ¡¿**ç„¡ç§»å‹•çš„é»æ“Š**â†’ åœ¨ä¸‰æ®µé«˜åº¦ä¹‹é–“å¾ªç’°åˆ‡æ›ï¼›**æ‹–æ›³å¾Œæ”¾é–‹**â†’ åœåœ¨æ”¾é–‹ä½ç½®ï¼ˆä¸å†è‡ªå‹•å¸é™„æœ€è¿‘æ®µé»ï¼‰
  - æ©¡çš®ç­‹é˜»åŠ›ä¿‚æ•¸ 0.2 â†’ 0.1ï¼Œè¶…éé‚Šç•Œæ™‚æ»‘å‹•æ›´æœ‰é˜»åŠ›æ„Ÿ
  - `setSidebarHeight()` åŠ å…¥ null å®‰å…¨æª¢æŸ¥ï¼ŒåŒæ­¥å¯«å…¥ `window.currentSidebarHeight` ä¾›å…¶ä»–æ¨¡çµ„è®€å–ç›®å‰é«˜åº¦
- **æœå°‹æ¡†é–‹å•Ÿè¡Œç‚ºï¼ˆæ‰‹æ©Ÿç‰ˆï¼‰**ï¼ˆ`js/theme.js`ï¼‰
  - `toggleSearch()` åœ¨æ‰‹æ©Ÿç‰ˆé–‹å•Ÿæœå°‹æ™‚ï¼Œè‡ªå‹•é—œé–‰è©³ç´°é ï¼ˆ`window.closeDetailView()`ï¼‰ä¸¦å±•é–‹ Bottom Sheet è‡³æœ€å¤§é«˜åº¦
- **æ¨™è¨˜/å¡ç‰‡é»æ“Šä¸æ¸…é™¤æœå°‹**ï¼ˆ`js/ui.js`ï¼‰
  - é»æ“Šæ™¯é»å¡ç‰‡æˆ–åœ°åœ–æ¨™è¨˜æ™‚ï¼ŒåŸæœ¬æœƒæ¸…ç©ºæœå°‹æ¬„ä¸¦é‡æ–°æ¸²æŸ“ï¼Œæ”¹ç‚ºåƒ…éœé»˜éš±è—æµ®å‹•æœå°‹æ¡†ï¼ˆ`.remove('show')`ï¼‰ï¼Œä¿ç•™æœå°‹è©
- **æ¨™è¨˜é«˜äº®é‡è©¦æ¬¡æ•¸æå‡**ï¼ˆ`js/map.js`ï¼‰
  - `highlightMarker` æœ€å¤§é‡è©¦æ¬¡æ•¸ 10 â†’ 20ï¼ˆç­‰å¾…æ™‚é–“ä¸Šé™ 50ms Ã— 20 = 1 ç§’ï¼‰ï¼Œç¢ºä¿æ¨™è¨˜åœ¨å‹•ç•«çµæŸå¾Œä»èƒ½è¢«æ‰¾åˆ°
- **CSS èª¿æ•´**ï¼ˆ`styles.css`ï¼‰
  - `.skeleton-wrapper` ä½”ä½é«˜åº¦ 160px â†’ 240pxï¼ˆé…åˆè¼ƒé«˜çš„å¡ç‰‡å…§å®¹ï¼‰
  - æ–°å¢ `@keyframes spin-once` èˆ‡ `.spin-anim i`ï¼šé‡æ•´æŒ‰éˆ•é»æ“Šå¾Œåœ–ç¤ºæ—‹è½‰ä¸€åœˆå‹•ç•«

---

## å‰ç«¯æ¨¡çµ„æ¶æ§‹

### èƒŒæ™¯èˆ‡å‹•æ©Ÿ

`index.html` åŸæœ¬å°‡æ‰€æœ‰ CSSï¼ˆ270 è¡Œï¼‰èˆ‡ JavaScriptï¼ˆ600 è¡Œï¼‰å…§åµŒåœ¨åŒä¸€å€‹æª”æ¡ˆï¼Œé›£ä»¥ç¶­è­·ã€‚
2026-02-22 å°‡å…¶æ‹†åˆ†ç‚ºæ¨™æº–çš„ ES Module çµæ§‹ï¼Œè®“æ¯å€‹æª”æ¡ˆåªè² è²¬å–®ä¸€è·è²¬ã€‚

### æ¨¡çµ„ä¾è³´åœ–ï¼ˆç„¡å¾ªç’°ä¾è³´ï¼‰

```
state.js          â† ç„¡ä»»ä½• importï¼ˆæ ¹ç¯€é»ï¼‰
  â”œâ”€ utils.js     â† state
  â”œâ”€ weather.js   â† state
  â”œâ”€ map.js       â† state
  â”œâ”€ ui.js        â† state, utils, weather, map
  â”œâ”€ data.js      â† state, utils, ui   ï¼ˆui ä¸åå‘ import dataï¼Œé¿å…å¾ªç’°ï¼‰
  â”œâ”€ theme.js     â† state, map, utils
  â”œâ”€ settings.js  â† state, data
  â””â”€ main.js      â† å…¨éƒ¨æ¨¡çµ„ï¼ˆå…¥å£é»ï¼‰
```

### å„æ¨¡çµ„è·è²¬

| æ¨¡çµ„ | è·è²¬ |
|------|------|
| `state.js` | å…±äº«å¯è®Šç‹€æ…‹ï¼ˆ`allLocations`ã€`map`ã€`currentFilter` ç­‰ï¼‰èˆ‡å¸¸æ•¸ï¼ˆ`categoryMap`ã€`iconMap`ï¼‰ |
| `utils.js` | ç„¡å‰¯ä½œç”¨çš„ç´”å‡½å¼ï¼š`getDayString`ã€`getCatName`ã€`processMarkdownForDisplay`ã€`updateTripInfoBar` |
| `weather.js` | å‘¼å« open-meteo APIï¼Œæ›´æ–°å¤©æ°£åˆ— |
| `map.js` | `initMap`ï¼ˆå»ºç«‹ Leaflet map ä¸¦å­˜å…¥ `state.map`ï¼‰ã€`checkMapLabels`ã€`getLocation`ã€`highlightMarker` |
| `ui.js` | æœ€å¤§çš„æ¨¡çµ„ï¼š`updateView`ï¼ˆé‡ç¹ªåœ°åœ–+å¡ç‰‡ï¼‰ã€`filterData`ã€detail viewã€bottom sheet æ‹–æ›³ã€Sortable åˆå§‹åŒ–ã€reading modal |
| `data.js` | `parseMarkdown`ï¼ˆè§£æ notes.mdï¼‰ã€`loadData`ã€`updateDay`ã€`saveContent`ã€`refreshData`ï¼ˆç„¡ç¸«é‡è®€ + æŒ‰éˆ•å‹•ç•«ï¼‰ï¼›å„²å­˜å¾Œå‘¼å« `updateView` |
| `theme.js` | `toggleTheme`ï¼ˆæ·±/æ·ºè‰²ï¼‰ã€`toggleMapLabels`ã€`toggleFab`ã€`toggleSearch`ã€`exportItinerary` |
| `settings.js` | æ—…éŠè¨­å®š Modalï¼ˆopenSettingsã€closeSettingsã€saveSettingsï¼‰ |
| `main.js` | åˆå§‹åŒ–é †åºã€åŒæ­¥ä¸»é¡Œåœ–ç¤ºã€è¨­å®š map click ç›£è½ã€æ›è¼‰æ‰€æœ‰ `window.*` å…¨åŸŸå‡½å¼ã€å‘¼å« `loadData()` |

### é—œéµè¨­è¨ˆæ±ºç­–

**1. é¿å…å¾ªç’°ä¾è³´**

`data.js` çš„ `loadData`ã€`updateDay`ã€`saveContent` åœ¨å„²å­˜å¾Œéœ€è¦å‘¼å« `updateView`ï¼Œå› æ­¤ `data.js` import `ui.js`ã€‚
åéä¾† `ui.js` **ä¸** import `data.js`ï¼ˆ`saveDetailContent` å’Œ `updateDayFromDetail` ç›´æ¥åœ¨ `ui.js` å…§ç”¨ `fetch` å‘¼å« APIï¼‰ï¼Œç¢ºä¿å–®å‘ä¾è³´ã€‚

**2. æ·±è‰²æ¨¡å¼é˜²é–ƒçˆï¼ˆFlash of Unstyled Contentï¼‰**

`index.html` çš„ `<head>` åŠ å…¥ä¸€è¡Œå…§åµŒ scriptï¼Œåœ¨ä»»ä½• CSS è¼‰å…¥å‰å³å¥—ç”¨ä¸»é¡Œï¼š

```html
<script>if (localStorage.getItem('theme') === 'dark') document.documentElement.setAttribute('data-theme', 'dark');</script>
```

`data-theme` è¨­åœ¨ `document.documentElement`ï¼ˆ`<html>`ï¼‰ï¼Œè€Œé `<body>`ï¼Œç¢ºä¿ CSS è®Šæ•¸åœ¨æœ€é ‚å±¤ç”Ÿæ•ˆã€‚
åŸæœ¬ JS è£¡çš„ `document.body.setAttribute(...)` å…¨éƒ¨æ”¹ç‚º `document.documentElement`ã€‚

**3. window.* å…¨åŸŸå‡½å¼**

`<script type="module">` å…§çš„è®Šæ•¸é è¨­ä¸æ›åˆ° `window`ï¼Œä½† HTML çš„ inline `onclick` å±¬æ€§éœ€è¦å…¨åŸŸå‡½å¼ã€‚
`main.js` çµ±ä¸€å°‡æ‰€æœ‰éœ€è¦è¢« HTML å‘¼å«çš„å‡½å¼æ›åˆ° `window`ï¼š

```js
window.toggleTheme = toggleTheme;
window.filterData = filterData;
window.updateDay = updateDay;
// ... ç­‰
```

**4. CDN å‡½å¼åº«è¼‰å…¥é †åº**

Leafletã€MarkerClusterã€PolylineDecoratorã€Sortable ç¶­æŒç”¨æ™®é€š `<script>` æ¨™ç±¤è¼‰å…¥ï¼ˆé moduleï¼‰ï¼Œ
æ”¾åœ¨ `<script type="module" src="js/main.js">` ä¹‹å‰ï¼Œç¢ºä¿é€™äº›å…¨åŸŸè®Šæ•¸ï¼ˆ`L`ã€`Sortable`ï¼‰åœ¨æ¨¡çµ„åŸ·è¡Œæ™‚å·²å¯ç”¨ã€‚

**5. map click ç›£è½æ”¾åœ¨ main.js**

`map.on('click', ...)` éœ€è¦åŒæ™‚å‘¼å« `closeDetailView`ï¼ˆä¾†è‡ª `ui.js`ï¼‰ã€‚
è‹¥æ”¾åœ¨ `map.js` è£¡æœƒé€ æˆ `map.js â†” ui.js` å¾ªç’°ä¾è³´ï¼Œæ•…ç§»è‡³ `main.js` è™•ç†ã€‚

### æ–°å¢æˆ–ä¿®æ”¹å‰ç«¯åŠŸèƒ½æ™‚çš„æ³¨æ„äº‹é …

- **æ–°å¢ç‹€æ…‹è®Šæ•¸**ï¼šåŠ åˆ° `js/state.js` çš„ `state` ç‰©ä»¶
- **æ–°å¢å·¥å…·å‡½å¼**ï¼šè‹¥ç´”å‡½å¼ï¼ˆç„¡ DOM æ“ä½œï¼‰åŠ åˆ° `utils.js`ï¼›è‹¥æ“ä½œ DOM è¦–æƒ…æ³åŠ åˆ°å°æ‡‰æ¨¡çµ„
- **æ–°å¢ inline onclick å‡½å¼**ï¼šåœ¨å°æ‡‰æ¨¡çµ„ exportï¼Œä¸¦åœ¨ `main.js` åŠ ä¸€è¡Œ `window.xxx = xxx`
- **ä¸è¦åœ¨ `ui.js` import `data.js`**ï¼šæœƒé€ æˆå¾ªç’°ä¾è³´ï¼Œæ‡‰è®“å‡½å¼ç›´æ¥ `fetch` API æˆ–é€é `main.js` å”èª¿
